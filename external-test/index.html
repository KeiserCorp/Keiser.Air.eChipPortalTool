<!DOCTYPE html>
<html>
<head>
	<style>
		body { color: #DADADA; background-color: #222222; }
		pre { padding: 5px; margin: 5px; }
		.string { color: #80CEFF; }
		.number { color: #FO8689; }
		.boolean { color: #D0F979; }
		.null { color: #F9F979; }
		.key { color: #80EF50; }
	</style>
</head>
<body>
	<pre id="output"></pre>
	
	<script type="text/javascript">
	(function () {
		var output = document.getElementById("output");
		var appWindow;
		var appOrigin;
		
		function onMessage(messageEvent) {
			appWindow = messageEvent.source;
			appOrigin = messageEvent.origin;
			var messageObject = JSON.parse(messageEvent.data);
			
			if (messageObject.type == 'request' && messageObject.action == 'connect'){
				var responseMessageObject = {
					id : messageObject.id,
					type : 'response',
					action : 'connect',
					data : {
						actions : ['echip-set']
					}
				};
				sendMessage(responseMessageObject);
			}
			
			output.innerHTML = syntaxHighlight(messageObject);
		}
		
		function sendMessage(messageObject) {
			if (appWindow && appOrigin) {
				appWindow.postMessage(JSON.stringify(messageObject), appOrigin)
			}
		}
		
		function syntaxHighlight(json) {
			if (typeof json != 'string') {
				 json = JSON.stringify(json, undefined, 2);
			}
			json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
			return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
				var cls = 'number';
				if (/^"/.test(match)) {
					if (/:$/.test(match)) {
						cls = 'key';
					} else {
						cls = 'string';
					}
				} else if (/true|false/.test(match)) {
					cls = 'boolean';
				} else if (/null/.test(match)) {
					cls = 'null';
				}
				return '<span class="' + cls + '">' + match + '</span>';
			});
		}
		
		window.addEventListener('message', onMessage);
	})();
	</script>
</body>
</html>